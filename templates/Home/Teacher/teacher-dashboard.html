{% extends 'Home/base.html' %}
{% load static %}


<link rel="stylesheet" href="{% static 'assets/plugins/bootstrap/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'assets/plugins/feather/feather.css' %}">
<link rel="stylesheet" href="{% static 'assets/plugins/icons/flags/flags.css' %}">
<link rel="stylesheet" href="{% static 'assets/plugins/fontawesome/css/fontawesome.min.css' %}">
<link rel="stylesheet" href="{% static 'assets/plugins/fontawesome/css/all.min.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
<link rel="stylesheet" href="{% static 'assets/plugins/select2/css/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/bootstrap-datetimepicker.min.css' %}">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">


<link rel="stylesheet" href="{% static 'assets/plugins/fullcalendar/fullcalendar.min.css' %}">


<link rel="stylesheet" href="{% static 'assets/plugins/simple-calendar/simple-calendar.css' %}">

<link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
<!-- Include the necessary CSS and JS for the datepicker -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>



{% block body %}


    <div class="page-wrapper">
        <div class="content container-fluid">

            <div class="page-header">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="page-sub-header">
                            <h3 class="page-title">Welcome {{ user.group }}!</h3>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="../Admin/index.html">Home</a></li>
                                <li class="breadcrumb-item active">Teacher</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-comman w-100">
                        <div class="card-body">
                            <div class="db-widgets d-flex justify-content-between align-items-center">
                                <div class="db-info">
                                    <h6>Total Classes</h6>
                                    <h3>04/06</h3>
                                </div>
                                <div class="db-icon">
                                    <img src="{% static 'assets/img/icons/teacher-icon-01.svg' %}" alt="Dashboard Icon">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-comman w-100">
                        <div class="card-body">
                            <div class="db-widgets d-flex justify-content-between align-items-center">
                                <div class="db-info">
                                    <h6>Total Students</h6>
                                    <h3>40/60</h3>
                                </div>
                                <div class="db-icon">
                                    <img src="{% static 'assets/img/icons/dash-icon-01.svg' %}" alt="Dashboard Icon">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-comman w-100">
                        <div class="card-body">
                            <div class="db-widgets d-flex justify-content-between align-items-center">
                                <div class="db-info">
                                    <h6>Total Lessons</h6>
                                    <h3>30/50</h3>
                                </div>
                                <div class="db-icon">
                                    <img src="{% static 'assets/img/icons/teacher-icon-02.svg' %}" alt="Dashboard Icon">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-sm-6 col-12 d-flex">
                    <div class="card bg-comman w-100">
                        <div class="card-body">
                            <div class="db-widgets d-flex justify-content-between align-items-center">
                                <div class="db-info">
                                    <h6>Total Hours</h6>
                                    <h3>15/20</h3>
                                </div>
                                <div class="db-icon">
                                    <img src="{% static 'assets/img/icons/teacher-icon-03.svg' %}" alt="Dashboard Icon">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-12 col-lg-12 col-xl-8">
                    <div class="row">
                        <div class="col-12 col-lg-8 col-xl-8 d-flex">
                            <div class="card flex-fill comman-shadow">
                                <div class="card-header">
                                    <div class="row align-items-center">
                                        <div class="col-6">
                                            <h5 class="card-title">Today's Schedule ({{ current_day }})</h5>
                                        </div>
                                        <div class="col-6">
                                            <span class="float-end view-link"><a href="#">View All Lessons</a></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="pt-3 pb-3">
                                    <div class="table-responsive lesson">
                                        <table class="table table-center">
                                            <tbody>
                                            {% for slot in upcoming_slots %}
                                                <tr>
                                                    <td>
                                                        <div class="date">
                                                            <b>{{ slot.teacher_assignment.subject.name }}</b>
                                                            <p>{{ slot.room.room_name }}</p>
                                                            <ul class="teacher-date-list">
                                                                <li><i class="fas fa-calendar-alt me-2"></i>Sep 5, 2022
                                                                </li>
                                                                <li>|</li>
                                                                <li>
                                                                    <i class="fas fa-clock me-2"></i>{{ slot.time_slot.time_range }}
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="lesson-confirm">
                                                            <a href="#">Confirmed</a>
                                                        </div>
                                                        {% if not slot.is_rescheduled %}
                                                            <a href="{% url 'reschedule_slot' slot.id %}"
                                                               class="reschedule-btn"
                                                               data-toggle="modal"
                                                               data-target="#rescheduleModal{{ slot.id }}">
                                                                Reschedule
                                                            </a>
                                                        {% endif %}

                                                    </td>
                                                </tr>
                                            {% empty %}
                                                <p>No classes scheduled for today</p>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- templates/teachers/base.html -->
                                    <div class="notification-container">
                                        <div class="notification-icon" onclick="toggleNotifications()">
                                            <i class="fas fa-bell"></i>
                                            {% if unread_count > 0 %}
                                                <span class="notification-badge">{{ unread_count }}</span>
                                            {% endif %}
                                        </div>

                                        <div class="notification-dropdown" id="notificationDropdown">
                                            <div class="notification-header">
                                                <h4>Notifications</h4>
                                                <button class="mark-all-read" onclick="markAllRead()">
                                                    Mark all as read
                                                </button>
                                            </div>

                                            <div class="notification-list">
                                                {% for notification in notifications %}
                                                    <div class="notification-item {% if not notification.read %}unread{% endif %}"
                                                         data-id="{{ notification.id }}"
                                                         onclick="markAsRead(this, '{{ notification.link|default:'#' }}')">
                                                        <div class="notification-message">
                                                            {{ notification.message }}
                                                        </div>
                                                        <div class="notification-time">
                                                            {{ notification.created_at|timesince }} ago
                                                        </div>
                                                    </div>
                                                {% empty %}
                                                    <div class="no-notifications">
                                                        No new notifications
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-4 col-xl-4 d-flex">
                            <div class="card flex-fill comman-shadow">
                                <div class="card-header">
                                    <div class="row align-items-center">
                                        <div class="col-12">
                                            <h5 class="card-title">Semester Progress</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="dash-widget">
                                    <div class="circle-bar circle-bar1">
                                        <div class="circle-graph1" data-percent="50">
                                            <div class="progress-less">
                                                <b>55/60</b>
                                                <p>Lesson Progressed</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <ul>
                                        {% for section in assigned_grade_sections %}
                                            <li>{{ section.name }}</li>
                                        {% endfor %}
                                    </ul>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-12 col-xl-12 d-flex">
                            {#                            <div class="card flex-fill comman-shadow">#}
                            {#                                <div class="card-header">#}
                            {#                                    <div class="row align-items-center">#}
                            {#                                        <div class="col-6">#}
                            {#                                            <h5 class="card-title">Teaching Activity</h5>#}
                            {#                                        </div>#}
                            {#                                        <div class="col-6">#}
                            {#                                            <ul class="chart-list-out">#}
                            {#                                                <li><span class="circle-blue"></span>Teacher</li>#}
                            {#                                                <li><span class="circle-green"></span>Students</li>#}
                            {#                                                <li class="star-menus"><a href="javascript:;"><i#}
                            {#                                                        class="fas fa-ellipsis-v"></i></a></li>#}
                            {#                                            </ul>#}
                            {#                                        </div>#}
                            {#                                    </div>#}
                            {#                                </div>#}
                            {#                                <div class="card-body">#}
                            {#                                    <div id="school-area"></div>#}
                            {#                                </div>#}
                            {#                            </div>#}
                        </div>
                        <div class="col-12 col-lg-12 col-xl-12 d-flex">
                            <div class="card flex-fill comman-shadow">
                                <div class="card-header d-flex align-items-center">
                                    <h5 class="card-title">Teaching History</h5>
                                    <ul class="chart-list-out student-ellips">
                                        <li class="star-menus"><a href="javascript:;"><i class="fas fa-ellipsis-v"></i></a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-body">
                                    <div class="teaching-card">
                                        <ul class="steps-history">
                                            <li>Sep22</li>
                                            <li>Sep23</li>
                                            <li>Sep24</li>
                                        </ul>
                                        <ul class="activity-feed">
                                            <li class="feed-item d-flex align-items-center">
                                                <div class="dolor-activity">
                                                    <span class="feed-text1"><a>Mathematics</a></span>
                                                    <ul class="teacher-date-list">
                                                        <li><i class="fas fa-calendar-alt me-2"></i>September 5, 2022
                                                        </li>
                                                        <li>|</li>
                                                        <li><i class="fas fa-clock me-2"></i>09:00 am - 10:00 am (60
                                                            Minutes)
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="activity-btns ms-auto">
                                                    <button type="submit" class="btn btn custom-bg text-white">In
                                                        Progress
                                                    </button>
                                                </div>
                                            </li>
                                            <li class="feed-item d-flex align-items-center">
                                                <div class="dolor-activity">
                                                    <span class="feed-text1"><a>Geography	</a></span>
                                                    <ul class="teacher-date-list">
                                                        <li><i class="fas fa-calendar-alt me-2"></i>September 5, 2022
                                                        </li>
                                                        <li>|</li>
                                                        <li><i class="fas fa-clock me-2"></i>09:00 am - 10:00 am (60
                                                            Minutes)
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="activity-btns ms-auto">
                                                    <button type="submit" class="btn btn custom-bg text-white">
                                                        Completed
                                                    </button>
                                                </div>
                                            </li>
                                            <li class="feed-item d-flex align-items-center">
                                                <div class="dolor-activity">
                                                    <span class="feed-text1"><a>Botony</a></span>
                                                    <ul class="teacher-date-list">
                                                        <li><i class="fas fa-calendar-alt me-2"></i>September 5, 2022
                                                        </li>
                                                        <li>|</li>
                                                        <li><i class="fas fa-clock me-2"></i>09:00 am - 10:00 am (60
                                                            Minutes)
                                                        </li>
                                                    </ul>
                                                </div>
                                                <div class="activity-btns ms-auto">
                                                    <button type="submit" class="btn btn custom-bg text-white">In
                                                        Progress
                                                    </button>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            {% if grade_sections %}
                                <ul>
                                    {% for grade_section in grade_sections %}
                                        <li>
                                            {{ grade_section.name }}
                                            <a href="{% url 'mark_attendance' grade_section.id current_term.id %}"
                                               class="btn btn-primary">
                                                Mark Attendance
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p>You are not assigned to any grade sections.</p>
                            {% endif %}


                        </div>


                    </div>
                    <div class="col-12 col-lg-12 col-xl-4 d-flex">
                        <div class="card flex-fill comman-shadow">
                            <div class="card-body">
                                <div id="calendar-doctor" class="calendar-container"></div>
                                {#                            <div id="calendar" class="calendar-container">#}
                                {#                            </div>#}
                                <div class="calendar-info calendar-info1">
                                    <div class="up-come-header">
                                        <h2>Upcoming Events</h2>
                                        <span><a href="javascript:;"><i class="feather-plus"></i></a></span>
                                    </div>
                                    <div class="upcome-event-date">
                                        <h3>10 Jan</h3>
                                        <span><i class="fas fa-ellipsis-h"></i></span>
                                    </div>
                                    <div class="calendar-details">
                                        <p>08:00 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>Botony</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>08:00 - 09:00 am</span>
                                        </div>
                                    </div>
                                    <div class="calendar-details">
                                        <p>09:00 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>Botony</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>09:00 - 10:00 am</span>
                                        </div>
                                    </div>
                                    <div class="calendar-details">
                                        <p>10:00 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>Botony</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>10:00 - 11:00 am</span>
                                        </div>
                                    </div>
                                    <div class="upcome-event-date">


                                        <h2>Lessons for <span id="today"></span></h2>
                                        <table id="lessons-table">
                                            <thead>
                                            <tr>
                                                <th>Time</th>
                                                <th>Subject</th>
                                                <th>Grade Section</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <!-- Lessons will be dynamically added here -->
                                            </tbody>
                                        </table>


                                        <h3>10 Jan</h3>
                                        <span><i class="fas fa-ellipsis-h"></i></span>
                                    </div>


                                    <div class="calendar-details">
                                        <p>08:00 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>English</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>08:00 - 09:00 am</span>
                                        </div>
                                    </div>
                                    <div class="calendar-details">
                                        <p>09:00 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>Mathematics </h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>09:00 - 10:00 am</span>
                                        </div>
                                    </div>
                                    <div class="calendar-details">
                                        <p>10:00 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>History</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>10:00 - 11:00 am</span>
                                        </div>
                                    </div>
                                    <div class="calendar-details">
                                        <p>11:00 am</p>
                                        <div class="calendar-box break-bg">
                                            <div class="calandar-event-name">
                                                <h4>Break</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>11:00 - 12:00 am</span>
                                        </div>
                                    </div>
                                    <div class="calendar-details">
                                        <p>11:30 am</p>
                                        <div class="calendar-box normal-bg">
                                            <div class="calandar-event-name">
                                                <h4>History</h4>
                                                <h5>Lorem ipsum sit amet</h5>
                                            </div>
                                            <span>11:30 - 12:00 am</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <footer>
                <p>Copyright © 2022 Dreamguys.</p>
            </footer>


        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>


    <script>
        // static/js/notifications.js
        function toggleNotifications() {
            const dropdown = document.getElementById('notificationDropdown');
            dropdown.classList.toggle('show');
        }

        function markAsRead(element, link) {
            const notificationId = element.dataset.id;
            fetch(`/notifications/mark-read/${notificationId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        element.classList.remove('unread');
                        updateBadgeCount(-1);
                        if (link && link !== '#') window.location.href = link;
                    }
                });
        }

        function markAllRead() {
            fetch('/notifications/mark-all-read/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (response.ok) {
                        document.querySelectorAll('.unread').forEach(item => {
                            item.classList.remove('unread');
                        });
                        updateBadgeCount('clear');
                    }
                });
        }

        function updateBadgeCount(change) {
            const badge = document.querySelector('.notification-badge');
            if (!badge) return;

            let count = parseInt(badge.textContent);
            if (change === 'clear') {
                badge.remove();
            } else {
                count += change;
                badge.textContent = count > 0 ? count : '';
                if (count <= 0) badge.remove();
            }
        }
    </script>

    <script>
        // Get today's date in 'YYYY-MM-DD' format
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('today').textContent = today;

        // Get the teacher's ID from the logged-in user
        const teacherId = {{ request.user.teacher.id }};  // Make sure this exists

        // Fetch lessons data from the API
        fetch(`/api/teacher/${teacherId}/schedule/${today}/`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('#lessons-table tbody');
                if (data.length > 0) {
                    data.forEach(lesson => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${lesson.start_time} - ${lesson.end_time}</td>
                            <td>${lesson.subject_name}</td>
                            <td>${lesson.grade_section_name}</td>
                           
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="4">No lessons scheduled for today.</td>';
                    tableBody.appendChild(row);
                }
            })
            .catch(error => {
                console.error('Error fetching schedule:', error);
            });
    </script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth'
            });
            calendar.render();
        });

    </script>

    <script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>

    <script src="{% static 'assets/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

    <script src="{% static 'assets/js/feather.min.js' %}"></script>

    <script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>



    <script src="{% static 'assets/plugins/simple-calendar/jquery.simple-calendar.js' %}"></script>
    <script src="{% static 'assets/js/calender.js' %}"></script>

    <script src="{% static 'assets/js/circle-progress.min.js' %}"></script>

    <script src="{% static 'assets/js/script.js' %}"></script>

    <script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
    <script src="{% static 'assets/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/js/feather.min.js' %}"></script>
    <script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>
    <script src="{% static 'assets/plugins/apexchart/apexcharts.min.js' %}"></script>
    <script src="{% static 'assets/plugins/apexchart/chart-data.js' %}"></script>
    <script src="{% static 'assets/js/script.js' %}"></script>


{% endblock %}