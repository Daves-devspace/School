{% extends 'Home/base.html' %}
{% load static %}
{% load crispy_forms_filters %}

{% block title %}
    <title>Collect Fees</title>
{% endblock %}

{% block body %}
    <div class="page-wrapper">
        <div class="content container-fluid">

            <div class="row">
                <div class="col-sm-12">
                    <div class="card card-table">
                        <div class="card-body">
                            <div class="card d-flex justify-content-center align-items-center w-100">
                               
                                <div class="row w-100">
                                     <h1>Expenses</h1>
                                    <!-- Expenses Summary -->
                                    <div class="col-md-6 d-flex flex-column ">
                                        <div class="summary">
                                            <p><strong>Total Revenue:</strong> {{ total_revenue }}</p>
                                            <p><strong>Total Expenses:</strong> {{ total_expenses }}</p>
                                            <p><strong>Net Revenue:</strong> {{ net_revenue }}</p>
                                        </div>
                                        <!-- Add Expense Form -->
                                        <form method="POST" class="mt-3">
                                            {% csrf_token %}
                                            {{ form | crispy }}
                                            <button class="btn accent-background text-white d-flex rounded mt-2" type="submit">Add Expense</button>
                                        </form>
                                    </div>
                                    

                                    <!-- Spending Trends -->
                                    <div class="col-md-6 d-flex border-left flex-column align-items-center justify-content-center">
                                        <h3>Spending Trends</h3>
                                                  <canvas id="expensesChart"></canvas>





                                    </div>
                                </div>
                            </div>
                            
                        </div>

                        <!-- Expense List -->
                        <h2>Expense List</h2>
                        <div class="table-responsive">
                            <table class="table table-hover table-center mb-0 datatable">
                                <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Recived by</th>
                                    <th>Amount</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for expense in expenses %}
                                    <tr>
                                        <td>{{ expense.date }}</td>
                                        <td>{{ expense.description }}</td>
                                        <td>{{ expense.paid_to }}</td>
                                        <td>{{ expense.amount }}</td>
                                        <td><a href="{% url 'delete_expense' expense.id %}"><i
                                                class="fas fa-trash btn btn-sm accent-background text-white mr-2"></i></a></td>
                                                      
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>


                    </div>
                </div>
            </div>


            <p>add more details</p>
        <div id="chart"></div>
        </div>
    </div>
    </div>





<script>
    function renderChart(data) {
        const ctx = document.getElementById('expensesChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.data.labels, // e.g., ["Apr", "Oct", "Nov", "Dec"]
                datasets: data.data.datasets // Revenue and Expenses datasets
            },
            options: {
                title: {
                    display: true,
                    text: data.title
                }
            }
        });
    }

    // Fetch the chart data
    $.ajax({
        url: "/management/revenue-trend/", // URL to fetch data
        type: "GET",
        dataType: "json",
        success: function (response) {
            renderChart(response);
        },
        error: function (error) {
            console.error("Error fetching chart data:", error);
        }
    });
</script>









{##}
{#    <script>#}
{#    $(document).ready(function () {#}
{#        // Fetch the data from the API#}
{#        $.ajax({#}
{#            url: "{% url 'line_chart' %}",  // Ensure the URL points to your updated `line_chart` view#}
{#            type: "GET",#}
{#            dataType: "json",#}
{#            success: function (response) {#}
{#                var options = {#}
{#                    chart: {#}
{#                        height: 350,#}
{#                        type: "area", // Chart type: "area" or "line"#}
{#                        toolbar: {#}
{#                            show: false#}
{#                        }#}
{#                    },#}
{#                    title: {#}
{#                        text: response.title, // Set the chart title from JSON#}
{#                        align: 'center', // Align title to center#}
{#                        style: {#}
{#                            fontSize: '16px', // Font size for title#}
{#                        },#}
{#                    },#}
{#                    dataLabels: {#}
{#                        enabled: false // Disable data labels#}
{#                    },#}
{#                    stroke: {#}
{#                        curve: "smooth" // Smooth line curves#}
{#                    },#}
{#                    series: [#}
{#                        {#}
{#                            name: response.data.datasets[0].label, // Use the first dataset's label#}
{#                            data: response.data.datasets[0].data  // Use the first dataset's data#}
{#                        },#}
{#                        {#}
{#                            name: response.data.datasets[1].label, // Use the second dataset's label#}
{#                            data: response.data.datasets[1].data  // Use the second dataset's data#}
{#                        }#}
{#                    ],#}
{#                    xaxis: {#}
{#                        categories: response.data.labels // Set the X-axis categories#}
{#                    },#}
{#                    colors: [#}
{#                        "rgba(78, 115, 223, 1)", // Color for Revenue#}
{#                        "rgba(255, 99, 132, 1)"  // Color for Expenses#}
{#                    ],#}
{#                    fill: {#}
{#                        opacity: 0.1,#}
{#                        type: "gradient",#}
{#                        gradient: {#}
{#                            shadeIntensity: 1,#}
{#                            opacityFrom: 0.7,#}
{#                            opacityTo: 0.1,#}
{#                            stops: [0, 90, 100]#}
{#                        }#}
{#                    }#}
{#                };#}
{##}
{#                // Render the chart#}
{#                var chart = new ApexCharts(#}
{#                    document.querySelector("#charts-area"), // Ensure this ID matches your HTML container#}
{#                    options#}
{#                );#}
{#                chart.render();#}
{#            },#}
{#            error: function (error) {#}
{#                console.error("Error fetching chart data:", error);#}
{#            }#}
{#        });#}
{#    });#}
{#</script>#}





{% endblock %}